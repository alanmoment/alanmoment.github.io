<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    Android // Hello World!!
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="generator" content="Hugo 0.15" />

  <meta property="og:title" content="Android" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="http://alanmoment.github.io/tags/android/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="http://alanmoment.github.io//css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="http://alanmoment.github.io/tags/android/index.xml" rel="alternate" type="application/rss+xml" title="Hello World!!" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/tomorrow-night-bright.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  
</head>

<body>
	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

	
	  <img src="/images/avatar.jpg" class="sidebarphoto">
	

    <h1 class="brand-title">Hello World!!</h1>
    <h2 class="brand-tagline">you can do anything you want to do.</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="http://alanmoment.github.io/">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/page/about/">About me</a></li>
        
      </ul>
    </nav>

    
    <div class="social-buttons">
      
        
        <a href="https://github.com/alanmoment" target="_blank"><i class='fa fa-github'></i></a>
        
      
        
        <a href="https://www.linkedin.com/in/alanmoment" target="_blank"><i class='fa fa-linkedin'></i></a>
        
      
        
        <a href="http://www.twitter.com/alanmoment" target="_blank"><i class='fa fa-twitter'></i></a>
        
      
      
    </div>
    

  </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
      <a name="top"></a>
      

      <div class="posts">
        
          <section  class="post">
            <header class="post-header">
            
            <h1 class="post-title">
              <a href="/post/android/android_universal_image_loader/">Android Universal Image Loader</a>
            </h1>
            </header>
            <p class="post-meta">
            	
		          <span class="post-date">
		            <span class="post-date-day"><sup>28</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Nov</span> <span class="post-date-year">2013</span>
		          </span>
      				
      				
      					By <a class="post-author" >Alan</a>
      				
              
                <span class="post-reading-time"><i class="fa fa-clock-o"></i> <em>2 min. read</em></span>
              
      				
      					<div class="post-categories">
				        
      					
					        <a class="post-category post-category-2013" href="http://alanmoment.github.io//categories/2013">2013</a>
      					
      					</div>
      				
            </p>
            <article class="post-summary">
            	開發了一陣子的Android，一開始著墨在功能是否能正常運作，現在注重的地方在校能，因為常發生閃退，或未知的錯誤，這邊要講一下下載遠端的圖片加強版。 繼上次發表AsyncTask Download Image by the Android，這一篇發現了其中有些問題。若是大量的圖片，會產生大量的AsyncTask，會造成閃退，以及其他的AsyncTask無法運作，所以有個工具是Android-Universal-Image-Loader，它已經幫使用者處理這部份的問題了，使用起來也很簡單。也不會有AsyncTask阻塞的問題。 Gradle 有兩種方式載入jar檔 官網下載jar檔放進libs，在build.gradle的dependencies中建立compile files('libs/universal-image-loader-1.8.6.jar') 自動下載，在build.gradle的dependencies中建立 compile 'com.nostra13.universalimageloader:universal-image-loader:1.8.6' Usage 我自己寫一隻方便使用的Base /** * ImageLoader Base * * @author Alan * @since 2013/09/06 */ public class BaseImageLoader { private static ImageLoader imageLoader; private static DisplayImageOptions options; private String path = &quot;loader_cache&quot;; private int stubImage = R.drawable.default; private int emptyImage = R.drawable.default; private int failImage = R.drawable.default; private int fadeInTimestamp = 500; public BaseImageLoader(Context context) { File
            </article>
			<div class="read-more-link">
				<a href="/post/android/android_universal_image_loader/"><span class="read-more-slashes">//</span>Read More...</a>
			</div>
          </section>
        
          <section  class="post">
            <header class="post-header">
            
            <h1 class="post-title">
              <a href="/post/android/use_thread_control_android_ui/">Use Thread control Android UI</a>
            </h1>
            </header>
            <p class="post-meta">
            	
		          <span class="post-date">
		            <span class="post-date-day"><sup>11</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Nov</span> <span class="post-date-year">2013</span>
		          </span>
      				
      				
      					By <a class="post-author" >Alan</a>
      				
              
                <span class="post-reading-time"><i class="fa fa-clock-o"></i> <em>1 min. read</em></span>
              
      				
      					<div class="post-categories">
				        
      					
					        <a class="post-category post-category-2013" href="http://alanmoment.github.io//categories/2013">2013</a>
      					
      					</div>
      				
            </p>
            <article class="post-summary">
            	在開發Android app若要用Thread改變UI的話會遇到這個Exception android.view.ViewRootImpl$CalledFromWrongThreadException: Only the original thread that created a view hierarchy can touch its views. at android.view.ViewRootImpl.checkThread(ViewRootImpl.java:4637) at android.view.ViewRootImpl.invalidateChildInParent(ViewRootImpl.java:876) at android.view.ViewGroup.invalidateChild(ViewGroup.java:4174) at android.view.View.invalidate(View.java:10313) 原因是Android不允許onCreate之後再建立Thread改變UI，所以得透過他提供的方法 // run on ui thread runOnUiThread(new Runnable() { public void run() { // TODO } }); 這樣就可以透過Thread來執行改變UI的事件了。 完整的範例如下，透過Thread 5秒後改變某個UI的屬性 // Start thread @Override protected void onResume() { super.onResume(); myThread.start(); } // Stop thread @Override public void onPause() { super.onPause(); myThread.interrupt(); } // Execute thread after 5s.
            </article>
			<div class="read-more-link">
				<a href="/post/android/use_thread_control_android_ui/"><span class="read-more-slashes">//</span>Read More...</a>
			</div>
          </section>
        
          <section  class="post">
            <header class="post-header">
            
            <h1 class="post-title">
              <a href="/post/android/asynctask_download_image_by_the_android/">AsyncTask download image by the Android</a>
            </h1>
            </header>
            <p class="post-meta">
            	
		          <span class="post-date">
		            <span class="post-date-day"><sup>18</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Oct</span> <span class="post-date-year">2013</span>
		          </span>
      				
      				
      					By <a class="post-author" >Alan</a>
      				
              
                <span class="post-reading-time"><i class="fa fa-clock-o"></i> <em>2 min. read</em></span>
              
      				
      					<div class="post-categories">
				        
      					
					        <a class="post-category post-category-2013" href="http://alanmoment.github.io//categories/2013">2013</a>
      					
      					</div>
      				
            </p>
            <article class="post-summary">
            	開發Android時常需要呈現圖片，但不可能圖片都是從Drawable中撈出來，一定有時需要從ImageServer或是透過網址取得圖片。 若是用一般的方式解決 try { URL url = new URL(imageUrl); HttpURLConnection connection = (HttpURLConnection) url.openConnection(); connection.setDoInput(true); connection.connect(); InputStream input = connection.getInputStream(); Bitmap bitmap = BitmapFactory.decodeStrea (input); return bitmap; } catch (IOException e) { e.printStackTrace(); return null; } 這樣子會造成讀取完圖片才會往下繼續執行的窘境，如果Timeout那畫面會停留更久。所以要用AsyncTask的特性來實作這個功能。 Android 4.0之後為了避免跟網路溝通時造成畫面停滯的問題，在與網路溝通的程式碼中必須要用執行緒的方式來進行與網路的溝通。 建立ImageDownloadTask 先在AndroidManifest.xml開啟網路權限 &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;&gt;&lt;/uses-permission&gt; 為了避免在短時間內下載重複的圖片，所以用url當作key做了cache的機制imageCache.put(params[0], mIcon11)，只要cache中不超過空間限制，都不會重複向遠端撈取圖片。 package com.example.test; import android.graphics.Bitmap; import android.graphics.BitmapFactory; import android.os.AsyncTask; import android.support.v4.util.LruCache; import android.util.Log; import android.widget.ImageView; import java.io.InputStream; import java.net.URLConnection; /** * 遠端下載圖片 * * @author Alan * @since 2013/10/05 */ public class ImageDownloadTask extends AsyncTask&lt;string void bitmap&gt; { private static final String LOG_TAG = ImageDownloadTask.class.getName(); private ImageView bmImage; private static LruCache imageCache; private static final int CACHE_SIZE = 1; //1MB public ImageDownloadTask(ImageView bmImage) { this.bmImage = bmImage; // 設定圖片快取 if (imageCache == null) { imageCache = new LruCache(CACHE_SIZE * 1024 * 1024); } } protected Bitmap doInBackground(String...
            </article>
			<div class="read-more-link">
				<a href="/post/android/asynctask_download_image_by_the_android/"><span class="read-more-slashes">//</span>Read More...</a>
			</div>
          </section>
        
          <section  class="post">
            <header class="post-header">
            
            <h1 class="post-title">
              <a href="/post/android/progressbar_while_loading_listview_of_android/">ProgressBar while loading ListView of Android</a>
            </h1>
            </header>
            <p class="post-meta">
            	
		          <span class="post-date">
		            <span class="post-date-day"><sup>11</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Oct</span> <span class="post-date-year">2013</span>
		          </span>
      				
      				
      					By <a class="post-author" >Alan</a>
      				
              
                <span class="post-reading-time"><i class="fa fa-clock-o"></i> <em>2 min. read</em></span>
              
      				
      					<div class="post-categories">
				        
      					
					        <a class="post-category post-category-2013" href="http://alanmoment.github.io//categories/2013">2013</a>
      					
      					</div>
      				
            </p>
            <article class="post-summary">
            	ListView通常是用來顯示列表的Widget，但是一般不可能直接從不管是遠端的Database或是Sqlite撈出全部的資料然後直接顯示，一定是分批撈取分批顯示。 這時就需要一個Loading畫面讓Client知道說，當前正在載入資料。不管是跳Dialog或是像Facebook一樣在畫面Bottom顯示Loading layout都可以。 我採取的是像Facebook一樣的方式呈現。 建立MainActivity.java simpleAdapter可另外設置R.layout.listview_item讓ListView中的資料吃別隻xml。 package com.example.test; import android.app.Activity; import android.content.Context; import android.os.Bundle; import android.util.Log; import android.view.Gravity; import android.widget.AbsListView; import android.widget.LinearLayout; import android.widget.ListView; import android.widget.ProgressBar; import android.widget.SimpleAdapter; import android.widget.TextView; import java.util.ArrayList; import java.util.HashMap; import java.util.List; import java.util.Map; public class MainActivity extends Activity { private String TAG_LOG = MainActivity.class.getName(); // ViewList需要用到的制定鍵值 String[] adapterKey; // ViewList需要用到的制定鍵值 int[] adapterViewKey; // 顯示讀取畫面的容器 LinearLayout loadingLayout; // 顯示列表的容器 ListView listView; // 列表 SimpleAdapter simpleAdapter; //
            </article>
			<div class="read-more-link">
				<a href="/post/android/progressbar_while_loading_listview_of_android/"><span class="read-more-slashes">//</span>Read More...</a>
			</div>
          </section>
        
          <section  class="post">
            <header class="post-header">
            
            <h1 class="post-title">
              <a href="/post/android/android_use_foreign_object_of_ormlite/">Android use foreign object of OrmLite</a>
            </h1>
            </header>
            <p class="post-meta">
            	
		          <span class="post-date">
		            <span class="post-date-day"><sup>1</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Oct</span> <span class="post-date-year">2013</span>
		          </span>
      				
      				
      					By <a class="post-author" >Alan</a>
      				
              
                <span class="post-reading-time"><i class="fa fa-clock-o"></i> <em>1 min. read</em></span>
              
      				
      					<div class="post-categories">
				        
      					
					        <a class="post-category post-category-2013" href="http://alanmoment.github.io//categories/2013">2013</a>
      					
      					</div>
      				
            </p>
            <article class="post-summary">
            	Android也有很好用的ActiveRecord可以應用，OrmLite提供了非常多的函式方便應用，架構也非常清楚，在跟SqlLite溝通時不再需要自己造輪子。 這邊記錄當ValueObject有繼承關係，又必須要有主附表關係時OrmLite的Foreign Key應用方法。 建立Major 類似像MySql的主附表應用，主表如下，@DatabaseTable是用在若要另外建立表名，則必須要設定這個值，若沒設定預設會用class的名字建立。 @DatabaseField則是欄位名稱。 package com.data; import com.j256.ormlite.field.DatabaseField; import com.j256.ormlite.table.DatabaseTable; /** * Created by Alan on 2013/9/18. */ @DatabaseTable(tableName=&quot;Major&quot;) public class Major { @DatabaseField private String parent; public void setParent(String parent) { this.parent = parent; } public String getParent() { return this.parent; } } 建立Minor 當Minor與Major是繼承關係時，同時又必須要包含另外的物件。這邊的@DatabaseField在參數中有foreign代表著這個屬性是外部鍵，指向另外一個物件的主鍵。並且foreignAutoRefresh是新增一筆資料後不用另外refresh。 package com.data; import com.j256.ormlite.field.DatabaseField; import com.j256.ormlite.table.DatabaseTable; /** * Created by Alan on 2013/9/18. */ @DatabaseTable(tableName = &quot;Minor&quot;) public class Minor extends Major { @DatabaseField(foreign=true, foreignAutoRefresh=true) private Other other; public Minor() { } @DatabaseField private String child; public void setChild(String child) { this.child = child; } public String getChild() { return this.child; } /** * 設定外部物件 */ public void setOther(Other other) { this.other = other; } /** * 取得外部物件 */ public Other getOther() { return this.other; } } 建立外部物件 外部物件若要和別的物件有Composition的關係，在這邊必須要有主鍵，而我設定generatedId=true就類似MySql的auto_increment屬性，讓物件可以自動生成ID，以便和別的物件建立指向關係。 package com.data; import com.j256.ormlite.field.DatabaseField; import com.j256.ormlite.table.DatabaseTable; /** * Created by Alan on 2013/9/18.
            </article>
			<div class="read-more-link">
				<a href="/post/android/android_use_foreign_object_of_ormlite/"><span class="read-more-slashes">//</span>Read More...</a>
			</div>
          </section>
        
          <section  class="post">
            <header class="post-header">
            
            <h1 class="post-title">
              <a href="/post/android/android_zipcode_library_of_maven/">Android zipcode library of maven</a>
            </h1>
            </header>
            <p class="post-meta">
            	
		          <span class="post-date">
		            <span class="post-date-day"><sup>3</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Sep</span> <span class="post-date-year">2013</span>
		          </span>
      				
      				
      					By <a class="post-author" >Alan</a>
      				
              
                <span class="post-reading-time"><i class="fa fa-clock-o"></i> <em>1 min. read</em></span>
              
      				
      					<div class="post-categories">
				        
      					
					        <a class="post-category post-category-2013" href="http://alanmoment.github.io//categories/2013">2013</a>
      					
      					</div>
      				
            </p>
            <article class="post-summary">
            	最近在做Android app時需要用到縣市、區域這些資料，做過網站的，都知道處理這個很煩啊!所以大多都會抽出來另外處理，封裝成Component好方便使用，但是在Android上要是把縣市、區域、郵遞區號放到strings.xml裡面，我想是會瘋掉的，維護、擴充也不容易。我就是建完才後悔的&hellip; 有個不錯的方法就是將資料用json的格式存成一隻檔案，然後自己寫抓取json的util放到Android的libs，這樣要使用就很方便了。 Eclipse安裝Maven 使用Eclipse plugin安裝Maven，在Install new software中點選Add輸入下列資料。 Name：Maven Plugin Location：http://download.eclipse.org/technology/m2e/releases 若是發生不能安裝的錯誤還有另外一個 Name：Indigo Location：http://download.eclipse.org/releases/indigo 在這個套件裡尋找Maven並且安裝 安裝Maven工具 Maven官網下載Maven 3.1.0 (Binary tar.gz)，放哪裡都可以但是建議不要放在含有空白或特殊字元的資料夾，最後要在環境變數加上以下變數。 變數名稱：MAVEN_HOME 變數值：C:\你的目錄\apache-maven-3.1.0 在Path變數尾端加上MAVEN_HOME %MAVEN_HOME%\bin; 建立Maven project 為了方便自己管理library所以我建立了maven project Step 1. Step 2. Step 3. 修改pom.xml 因為要解析json格式，所以在這邊需要引入google-gson的dependency，為什麼不用json-simple呢，因為Android並沒有支援這個library。 在&gt;標籤中加入 &lt;dependency&gt;&lt;groupid&gt;com.google.code.gson&lt;/groupid&gt;&lt;artifactid&gt;gson&lt;/artifactid&gt;&lt;version&gt;2.2.4&lt;/version&gt;&lt;/dependency&gt; 在project中Maven Dependencies就會增加gson library 建立zipcode.json 依照下圖的格式建立zipcode.json 將zipcode.json放置在src/main/resources，並且修改pom.xml，這樣在使用maven install就能夾帶檔案。 在&gt;標籤中加入 &lt;build&gt;&lt;resources&gt;&lt;resource&gt;&lt;directory&gt;src/main/resources&lt;/directory&gt;&lt;includes&gt;&lt;include&gt;zipcode.json&lt;/include&gt;&lt;/includes&gt;&lt;/resource&gt;&lt;/resources&gt;&lt;/build&gt; 建立Zipcode Library 建立InputStreamReader讀取json資料，再用gson解析讀取完畢再關掉。 因為gson會主動幫字串加上雙引號，所以取資料出來必須要用getAsString()，不能用toString()，否則雙引號不會濾掉。 package com.zipcode_util; import java.io.BufferedReader; import java.io.IOException; import java.io.InputStreamReader; import com.google.gson.Gson; import com.google.gson.JsonArray; import com.google.gson.JsonObject; public class ZipcodeComponent { private static final String ZIPCODE_FILE = &quot;zipcode.json&quot;; private static JsonObject jsonObject; /** * Json file io * @return JsonObject jsonObject */ private JsonObject getJsonObject() { if (jsonObject == null) { BufferedReader br = new BufferedReader( new InputStreamReader(ZipcodeComponent.class .getClassLoader().getResourceAsStream( ZipcodeComponent.ZIPCODE_FILE))); jsonObject = new Gson().fromJson(br, JsonObject.class); try { br.close(); } catch (IOException e) { e.printStackTrace(); } } return jsonObject; } /** * Get city name * @return List&lt;string&gt; citys */ public String[] listCities() { JsonArray jsonArray = getJsonObject().getAsJsonArray(&quot;city&quot;); String[] cities = new String[jsonArray.size()]; int i; for (i=0; i&lt;jsonarray.size i cities jsonarray.get return zipcode util package com.zipcode_util import junit.framework.test junit.framework.testcase junit.framework.testsuite unit test for simple app.
            </article>
			<div class="read-more-link">
				<a href="/post/android/android_zipcode_library_of_maven/"><span class="read-more-slashes">//</span>Read More...</a>
			</div>
          </section>
        
      </div>

      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>

	<p>&copy; 2016. All rights reserved.</p>
</div>
    </div>
  </div>
  
</body>
</html>
